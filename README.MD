# Example Agent for TotalAgility
This project provides an example TotalAgility package containing a template for a managing or planning agent, which in turn can call other worker or micro agents, as required, to complete its goal.

The agent desgin makes use of standardised input and output interfaces for Agent or Custom LLM type processes, meaning the managing agent can call any worker agent without needing to know specific details of how each worker agent is implemented.

 ![Example Managing Agent Pattern](./images/Example%20Managing%20Agent%20Pattern.png)

The pattern uses a registry of available worker agents, which are used in the planning step of the managing agent to describe the capabilities of each worker agent. 

This overall pattern is similar to "tool use" via MCP, and indeed the managing agent or worker agents can be called via an MCP Proxy using TotalAgility's OpenAPI REST interface. 

The package was created using TotalAgility 8.1.0.

## Package & Repo Contents
The following items details the contents of the TotalAgility package and associated repo.

![Example Agent package](./images/Example%20Agent%20package.png)

### Categories
This package creates a category called ```Example Agent``` accessible to everyone. 

### Data Models
3 data models are used in the Example Agent. This are configured as "local" Data Models inside the process itself but could also be used as global models if desired. 

 - ```Intent and Next Action Data Model.json``` this model is used to contain routing data to trigger the next step, as decided by the _Identify Intent & Next Action Planning_ step in the _Example Managing Agent Pattern_. 
 - ```Reflection Data Model.json``` this is the model used to hold the output of the _Reflection_ action, that determines when the agent is ready to respond. 
 - ```Tool Registry Data Model.json``` this is the model that is used to hold data about available tools and micro agents. Note that the name and process ID must match the details of the agents you wish to call. 

The json templates to create these models are provided in the repo under ```data models```.

### Processes
 - ```Example Managing Agent Pattern``` - this is the top level process that does the planning a uses tools / micro-agents   

### Utility Processes
These are synchronous processes, that provide utility functions. Included in the project are:
 - ```Util Trim HTML```
 - ```Util Trim Json``` 

These run scripts to trim wrapping markdown formatting from LLM generated HTML or Json respectively. 

### Example MicroAgent Processes
 - ```Micro Agent - Echo Response``` used by the test plan
 - ```Micro Agent - Get Active Jobs``` gets the active jobs in the system

### Integrations 
 - ```Web service references``` ==> ```TA Base URL``` used by the Get Active Jobs example agent. Update the details to reference your system's URL.

### Job Queries
 - _Get All Active Jobs_ this an example query called by the 

### Scripts
The project makes use of 2 script based processes that strip MD formatting from json or html data generated by Generative AI Activity steps in TotalAgility processes. The MD syntax is present due to system prompts used by the Generative AI Activity in TotalAgility. 

An alternative approach is to output from the Generative AI Activity into a Data Model, but in testing this approach provided less control over the exact output than prompting and outputing to a string. 

The scipts for these processes are included in the scripts folder of the repo. 

### Resources
 - api_user_example_agent - an Individual (ID) used to call the jobs api

## Setup - Smoke Test
1. Update the integtration _TA Base URL_ to point to your TotalAgility installation.
2. Update LLM providers from the default "Tungsten" provider if desired
3. Test by asking the ```Example Managing Agent Pattern``` in "debug" mode to echo back "hello world"
4. Test by asking the ```Example Managing Agent Pattern``` in "debug" mode - what jobs are currently active in the system, it should return a list of the jobs in the system.
(You can also create test plans to automate these tests)


## Extending & Integrating
5. Map a ```Integrations``` ==> ```Generative AI```  ==> ```Custom LLM``` to the ```Example Managing Agent Pattern``` process
6. Create a form that uses this new "Custom LLM" provider to power a Copilot or Generative AI Control. This will allow you to chat to the bot.
7. Create additional micro_agents as required using the agent I/O template.
8. Update LOOP_COUNT_MAX in ```Example Managing Agent Pattern``` to limit the number of interactions an agent can take when attempting to solve an issue.
9. Update the ```Tool Registry Json``` in the template agent to add in new micro_agents / tools to use, referncing the agents created in the previous step.
10. Optionally use the [TotalAgility-MSTeams-Agent](https://github.com/TungstenAutomationLabs/TotalAgility-MSTeams-Agent/) to add a Teams front end.
11. If you are interested in calling this project via MCP, I'll publish code to do this via an MCP Proxy Server shortly...
